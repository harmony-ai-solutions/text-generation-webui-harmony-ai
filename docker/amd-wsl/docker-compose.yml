services:
  text-generation-webui-amd-wsl:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        APP_GID: ${APP_GID:-6972}
        APP_UID: ${APP_UID:-6972}
    ports:
      - "${HOST_PORT:-7860}:7860"
      - "${HOST_API_PORT:-5000}:5000"
    devices:
      - /dev/dxg  # WSL2-specific GPU access device
    cap_add:
      - SYS_PTRACE
    security_opt:
      - seccomp=unconfined
    volumes:
      - ../../user_data:/app/text-generation-webui/user_data
      # WSL2 GPU access library - Override interfaces to allow GPU access
      - /usr/lib/wsl/lib/libdxcore.so:/usr/lib/libdxcore.so
